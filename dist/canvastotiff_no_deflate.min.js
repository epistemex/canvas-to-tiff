/*
	canvas-to-tiff 1.7.0
	(c) epistemex.com 2015-2017
	License: CC BY-NC-SA 4.0
*/
"use strict";var CanvasToTIFF={_dly:7,toArrayBuffer:function(c,a,t){t=t||{};var q=this,x=c.width,l=c.height,u=0,r=0,o=258,j=0,s=[],n,v="canvas-to-tiff 1.6\0",p=t.littleEndian,g=+(t.dpiX||t.dpi||96)|0,i=+(t.dpiY||t.dpi||96)|0,b=typeof ezlib!=="undefined"&&typeof ezlib.Deflate!=="undefined",d=typeof t.compressionLevel==="number"?Math.max(0,Math.min(9,t.compressionLevel)):6,f,m;f=c.getContext("2d");if(!f){f=document.createElement("canvas").getContext("2d");if(f){f.canvas.width=x;f.canvas.height=l;f.drawImage(c,0,0)}else{if(t.onError){t.onError({msg:"Cannot obtain a 2D context."})}else{console.log(e)}}}m=(function(h){try{return h.getImageData(0,0,x,l)}catch(w){if(t.onError){t.onError(w)}}})(f);if(b&&(typeof t.compress==="boolean"?t.compress:!0)){ezlib.deflateAsync(m.data,{level:d},function(h){k(h.result)},function(h){if(t.onError){t.onError(h)}})}else{k()}function k(F){var E=F?F.length:m.data.length,B=o+E,z=new ArrayBuffer(B),A=new Uint8Array(z),J=new DataView(z);G(p?18761:19789);G(42);H(8);w();h(254,4,1,0);h(256,4,1,x);h(257,4,1,l);h(258,3,4,r,8);h(259,3,1,F?8:1);h(262,3,1,2);h(273,4,1,o,0);h(277,3,1,4);h(279,4,1,E);h(282,5,1,r,8);h(283,5,1,r,8);h(296,3,1,2);h(305,2,v.length,r,D(v));h(306,2,20,r,20);h(338,3,1,2);y();H(524296);H(524296);H(g);H(1);H(i);H(1);I(v);I(C());A.set(F?F:m.data,o);setTimeout(function(){a(z)},q._dly);function C(){var K=new Date();return K.getFullYear()+":"+L(K.getMonth()+1)+":"+L(K.getDate())+" "+L(K.getHours())+":"+L(K.getMinutes())+":"+L(K.getSeconds());function L(M){return M<10?"0"+M:M}}function G(K){J.setUint16(u,K,p);u+=2}function H(K){J.setUint32(u,K,p);u+=4}function I(L){var K=0;while(K<L.length){J.setUint8(u++,L.charCodeAt(K++)&255)}if(u&1){u++}}function D(L){var K=L.length;return K&1?K+1:K}function h(M,N,K,O,L){G(M);G(N);H(K);if(L){r+=L;s.push(u)}if(K===1&&N===3&&!L){G(O);G(0)}else{H(O)}j++}function w(K){n=K||u;u+=2}function y(){J.setUint16(n,j,p);H(0);var K=14+j*12;for(var L=0,N,M;L<s.length;L++){N=s[L];M=J.getUint32(N,p);J.setUint32(N,M+K,p)}}}},toBlob:function(b,a,c){this.toArrayBuffer(b,function(d){a(new Blob([d],{type:"image/tiff"}))},c)},toDataURL:function(b,a,c){this.toBlob(b,function(d){var f=new FileReader();f.onload=function(){a(f.result)};f.onerror=function(){if(c&&c.onError){c.onError({msg:"Error converting data to Data-URI."})}};f.readAsDataURL(d)},c)}};